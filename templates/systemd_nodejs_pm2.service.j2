# {{ ansible_managed }}

[Unit]
Description={{ steamengine_project_name }} server

[Service]
Type=forking
PIDFile={{ steamengine_project_root_path }}/pm2/pm2.pid

ExecStart=/usr/local/lib/npm/bin/pm2 start {{ steamengine_project_root_path_web }}/{{ steamengine_nodejs_entrypoint }} --name {{ steamengine_project_name }} -l {{ steamengine_logs_path }}/node-app.log -e /dev/null -o /dev/null -i max
ExecReload=/usr/local/lib/npm/bin/pm2 reload all
ExecStop=/usr/local/lib/npm/bin/pm2 kill

Environment=NODE_ENV=production
Environment=HOME={{ steamengine_project_root_path }}
Environment=PM2_HOME={{ steamengine_project_root_path }}/pm2

Restart=always
RestartSec=10

LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity

User={{ steamengine_app_user }}
Group={{ steamengine_app_user }}
SyslogIdentifier={{ steamengine_project_name }}

[Install]
WantedBy=multi-user.target